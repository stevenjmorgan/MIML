---
title: "mice_sim"
author: "Xiaoran Sun"
date: "2018/11/18"
output: html_document
---
```{r}
setwd("~/Desktop/paper/SODA501/project/github/MIML/Simulation") #Xiaoran's working directory
library(mice)
```

simulate complete data (using codes from 'monte_carlo_exp.R')
```{r}
library(MASS)
seed <- 24519

# Create covariance matrix
S <- matrix(c(1.0, -0.12, -0.1, 0.5, 0.1,
             -0.12, 1.0, 0.1, -0.6, 0.1,
             -0.1, 0.1, 1.0, -0.5, 0.1,
             0.5, -0.6, -0.5, 1.0, 0.1,
             0.1, 0.1, 0.1, 0.1, 1.0), ncol = 5)
colnames(S) <- c("Y", "X1", "X2", "X3" ,"X4")

# Create a single dataset from multivariate normal dist. w/ 5 variables
set.seed(seed)
data <- mvrnorm(500, rep(0,5), S)
colnames(data) <- c("Y", "X1", "X2", "X3" ,"X4")
data<-data.frame(data)
```

Multiple imputation for missing data 
1. 'mcar1'
```{r}
#reading in
load("~/Desktop/paper/SODA501/project/github/MIML/Simulation/mcar1_singledf.RData")
names(mcar1)<- c("Y", "X1", "X2", "X3" ,"X4")

#multiple imputation
sim_miceData_mcar1 <- mice(mcar1,m=5,maxit=100,meth="pmm",seed=500)
summary(sim_miceData_mcar1)
save(sim_miceData_mcar1, file="sim_miceData_mcar1.RData")

sim_miceData_mcar1.implist <- lapply(seq(sim_miceData_mcar1$m), function(im) complete(sim_miceData_mcar1, im))

#Compute RMSE for comparing imputed and simulated data
library(Metrics)
RMSE_result<-data.frame(matrix(NA, ncol=5, nrow=5))
colnames(RMSE_result)<- c("Y", "X1", "X2", "X3" ,"X4")
rownames(RMSE_result)<-c("imp1", "imp2", "imp3", "imp4", "imp5")
for(i in 1:5){
  simdata<-sim_miceData_mcar1.implist[[i]]
  for (j in 1:5){
    RMSE_result[i,j]<-rmse(data[,j], simdata[,j])
  }
}
round(colMeans(RMSE_result),4)
```

2. 'mcar2'
```{r}
#reading in
load("~/Desktop/paper/SODA501/project/github/MIML/Simulation/mcar2_singledf.RData")
names(mcar2)<- c("Y", "X1", "X2", "X3" ,"X4")

#multiple imputation
sim_miceData_mcar2 <- mice(mcar2,m=5,maxit=100,meth="pmm",seed=500)
summary(sim_miceData_mcar2)
save(sim_miceData_mcar2, file="sim_miceData_mcar2.RData")

sim_miceData_mcar2.implist <- lapply(seq(sim_miceData_mcar2$m), function(im) complete(sim_miceData_mcar2, im))

#Compute RMSE for comparing imputed and simulated data
library(Metrics)
RMSE_result<-data.frame(matrix(NA, ncol=5, nrow=5))
colnames(RMSE_result)<- c("Y", "X1", "X2", "X3" ,"X4")
rownames(RMSE_result)<-c("imp1", "imp2", "imp3", "imp4", "imp5")
for(i in 1:5){
  simdata<-sim_miceData_mcar2.implist[[i]]
  for (j in 1:5){
    RMSE_result[i,j]<-rmse(data[,j], simdata[,j])
  }
}
round(colMeans(RMSE_result),4)
```

3. 'mar1'
```{r}
#reading in
load("~/Desktop/paper/SODA501/project/github/MIML/Simulation/mar1_singledf.RData")
names(mar1)<- c("Y", "X1", "X2", "X3" ,"X4")

#multiple imputation
sim_miceData_mar1 <- mice(mar1,m=5,maxit=100,meth="pmm",seed=500)
summary(sim_miceData_mar1)
save(sim_miceData_mar1, file="sim_miceData_mar1.RData")

sim_miceData_mar1.implist <- lapply(seq(sim_miceData_mar1$m), function(im) complete(sim_miceData_mar1, im))

#Compute RMSE for comparing imputed and simulated data
library(Metrics)
RMSE_result<-data.frame(matrix(NA, ncol=5, nrow=5))
colnames(RMSE_result)<- c("Y", "X1", "X2", "X3" ,"X4")
rownames(RMSE_result)<-c("imp1", "imp2", "imp3", "imp4", "imp5")
for(i in 1:5){
  simdata<-sim_miceData_mar1.implist[[i]]
  for (j in 1:5){
    RMSE_result[i,j]<-rmse(data[,j], simdata[,j])
  }
}
round(colMeans(RMSE_result),4)
```

4. 'mar2'
```{r}
#reading in
load("~/Desktop/paper/SODA501/project/github/MIML/Simulation/mar2_singledf.RData")
names(mar2)<- c("Y", "X1", "X2", "X3" ,"X4")

#multiple imputation
sim_miceData_mar2 <- mice(mar2,m=5,maxit=100,meth="pmm",seed=500)
summary(sim_miceData_mar2)
save(sim_miceData_mar2, file="sim_miceData_mar2.RData")

sim_miceData_mar2.implist <- lapply(seq(sim_miceData_mar2$m), function(im) complete(sim_miceData_mar2, im))

#Compute RMSE for comparing imputed and simulated data
library(Metrics)
RMSE_result<-data.frame(matrix(NA, ncol=5, nrow=5))
colnames(RMSE_result)<- c("Y", "X1", "X2", "X3" ,"X4")
rownames(RMSE_result)<-c("imp1", "imp2", "imp3", "imp4", "imp5")
for(i in 1:5){
  simdata<-sim_miceData_mar2.implist[[i]]
  for (j in 1:5){
    RMSE_result[i,j]<-rmse(data[,j], simdata[,j])
  }
}
round(colMeans(RMSE_result),4)
```